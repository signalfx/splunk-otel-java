import nebula.plugin.release.git.opinion.Strategies

plugins {
  id "java"
  id "com.diffplug.spotless" version "5.2.0" apply false
  id "nebula.release" version "15.0.1"
}

release {
  defaultVersionStrategy = Strategies.getSNAPSHOT()
}

group = "com.splunk.public"

boolean snapshot = getProperty("snapshot") == 'yes'

def versions = [
    'opentelemetry'         : snapshot ? "0.14.0-SNAPSHOT" : "0.13.1",
    'opentelemetryJavaagent': snapshot ? "0.14.0-SNAPSHOT" : '0.13.1'
]

subprojects {
  version = rootProject.version

  apply plugin: 'java'
  apply plugin: 'com.diffplug.spotless'
  apply from: "$rootDir/gradle/spotless.gradle"

  it.ext['versions'] = versions

  repositories {
    jcenter()
    mavenLocal()
    maven {
      url = uri("https://dl.bintray.com/open-telemetry/maven")
    }
    maven {
      url = uri("https://oss.jfrog.org/artifactory/oss-snapshot-local")
    }
    mavenCentral()
    if(snapshot){
      maven {
        url = uri("https://oss.sonatype.org/content/repositories/snapshots")
      }
    }
  }

  dependencies {
    testImplementation("org.mockito:mockito-core:3.5.15")
    testImplementation("org.mockito:mockito-junit-jupiter:3.5.15")
    testImplementation("org.junit.jupiter:junit-jupiter-api:5.6.2")
    testImplementation("org.junit.jupiter:junit-jupiter-params:5.6.2")
    testRuntimeOnly("org.junit.jupiter:junit-jupiter-engine:5.6.2")
    testImplementation("org.junit.jupiter:junit-jupiter-params:5.6.2")
  }

  tasks {
    test {
      useJUnitPlatform()
      reports {
        junitXml.outputPerTestCase = true
      }
    }
  }
}